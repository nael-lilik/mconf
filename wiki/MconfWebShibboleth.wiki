#summary How to enabled federated login with shibboleth

= Using Shibboleth in Mconf-Web =

<wiki:toc max_depth="3" />

== Introduction ==

Shibboleth is a solution that allows federated "single sign-in". In brief, this is how it works:
  * Users access services provided by "service providers" (e.g. a web application like Mconf-Web) through an entity called "identity provider".
  * The service provider redirects the users to an identity provider, the user enters his credentials, the identity provider validates the credentials and redirects the user back to the service provider.
  * The service provider receives just a controlled set of information of the user, such as his name and email.

You can read more about it [http://shibboleth.net/ here] and [http://en.wikipedia.org/wiki/Shibboleth_(Internet2) here].

== How it works in Mconf-Web ==

Mconf-Web is ready to be used as a Shibboleth service provider using the shibboleth module for Apache.

Once the shibboleth module is installed and configured, when a user is redirected to the url "`/secure`" in your Mconf-Web server, the shibboleth module will redirect the user to the identity provider configured. After the authentication the identity provider redirects the user back to Mconf-Web.

Mconf-Web will have access only to the information the identity provider returns. With this information a new account will be created automatically in Mconf-Web for the user. This happens only in the first access: in subsequent accesses the user will just access his account that is already created.

== Install and configure Apache's Shibboleth module ==

The configuration of a Shibboleth service provider is usually different for different federations. Some steps are shared in all installations, but some others are unique and depend on how the federation (and the identity providers) is configured. In this page we will show a guide with all the steps we use to configure Mconf-Web for the federation mconf.org is integrated with: [http://portal.rnp.br/web/servicos/cafe CAFe]. You can use it as a guide, but we strongly recommend also getting help from the people responsible for the federation you want to integrate Mconf-Web with.

This guide is strongly based on: http://wiki.rnp.br/pages/viewpage.action?pageId=41616305

=== Prerequisites ===

  * You need a server with Mconf-Web up and running (obviously). See [MconfWebDeploymentManual this guide].
  * Your Mconf-Web server needs to be using HTTPS (SSL) already. See [MconfWebSSL this guide].

=== Installation ===

Install Apache's module for Shibboleth:

{{{
sudo apt-get install libapache2-mod-shib2
}}}

Enable it:

{{{
sudo a2enmod shib2
}}}


=== Configuration ===

We need to configure our site in Apache to use Shibboleth when a user accesses the path `/secure`. To do that, add the following lines to the bottom `/etc/apache2/sites-available/mconf-web-ssl` file, just before the closing `</VirtualHost>` tag:

{{{
  <Location /secure>
    AuthType shibboleth
    ShibRequireSession On
    require valid-user
    Order allow,deny
    allow from all
  </Location>
}}}


Then we configure how the Shibboleth module will communicate with the identity provider. *This step will probably be different for other federations!*

We will create 3 files:

  * `/etc/shibboleth/shibboleth2.xml` with the contents from *step 8* in [http://wiki.rnp.br/pages/viewpage.action?pageId=41616305 this guide].
  * `/etc/shibboleth/attribute-map.xml` with the contents from *step 9* in [http://wiki.rnp.br/pages/viewpage.action?pageId=41616305 this guide].
  * `/etc/shibboleth/attribute-policy.xml` with the contents from *step 10* in [http://wiki.rnp.br/pages/viewpage.action?pageId=41616305 this guide].


== Enable and configure Shibboleth inside Mconf-Web ==