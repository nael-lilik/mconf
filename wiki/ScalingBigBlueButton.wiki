<font color="red">This document is under development.</font> The content described here is being used internally by Mconf.

= Introduction =

In this document we will describe step-by-step how to scale !BigBlueButton in order to support a larger number of participants. Currently the default installation of !BigBlueButton is designed to support up to 25 simultaneous users [[http://code.google.com/p/bigbluebutton/wiki/FAQ#How_many_simultaneous_users_can_BigBlueButton_support link]], but this guide is intended to increase this number to hundreds (or even thousands) of users.

= Installing !BigBlueButton 0.8 beta 3 =

Follow the instructions detailed [http://code.google.com/p/bigbluebutton/wiki/08InstallationUbuntu here].

= Installing FreeSWITCH =

{{{
# Add the BigBlueButton key
wget http://ubuntu.bigbluebutton.org/bigbluebutton.asc -O- | sudo apt-key add -

# Add the BigBlueButton repository URL and ensure the multiverse is enabled
echo "deb http://ubuntu.bigbluebutton.org/lucid_dev_08/ bigbluebutton-lucid main" | sudo tee /etc/apt/sources.list.d/bigbluebutton.list
echo "deb http://us.archive.ubuntu.com/ubuntu/ lucid multiverse" | sudo tee -a /etc/apt/sources.list

sudo apt-get install bbb-freeswitch bbb-freeswitch-config
}}}

= Configuring the !BigBlueButton server =

{{{
# Set the FreeSWITCH server IP address
FS_HOST=

sudo sed -i "s:sip\.server\.host=.*:sip.server.host=$FS_HOST:g" /usr/share/red5/webapps/sip/WEB-INF/bigbluebutton-sip.properties
sudo sed -i "s:esl\.host=.*:esl\.host=$FS_HOST:g" /usr/share/red5/webapps/bigbluebutton/WEB-INF/bigbluebutton.properties

# Restart the BigBlueButton server
sudo bbb-conf --clean
}}}

= Configuring the FreeSWITCH server =

{{{
# Get the current IP address from ifconfig
HOST=`ifconfig  | grep 'inet addr:'| grep -v '127.0.0.1' | cut -d: -f2 | awk '{ print $1}'`

sudo sed -i "s:name=\"listen-ip\" value=\".*\":name=\"listen-ip\" value=\"$HOST\":g" /opt/freeswitch/conf/autoload_configs/event_socket.conf.xml

# Restart the FreeSWITCH server
sudo service bbb-freeswitch restart
}}}


Uncomment the following line on `/opt/freeswitch/conf/sip_profiles/external.xml`. <font color="red">Check if it's really necessary!</font>

{{{
<!--<param name="force-register-domain" value="$${domain}"/>-->
}}}

= Installing OpenSIPS =

Installing the opensips system on a 32bit Debian virtual machine.

{{{
apt-get update && apt-get upgrade
apt-get install build-essential openssl bison flex
apt-get install mysql-server 
#insert MySQL root password
apt-get install libmysqlclient16 libmysqlclient-dev

wget http://opensips.org/pub/opensips/1.7.1/packages/debian/6.0-squeeze/opensips_1.7.1-1_i386.deb
wget http://opensips.org/pub/opensips/1.7.1/packages/debian/6.0-squeeze/opensips-mysql-module_1.7.1-1_i386.deb

#installing opensips package
dpkg -i opensips_1.7.1-1_i386.deb
}}}


Follow the instructions detailed [http://wiki.freeswitch.org/wiki/Enterprise_deployment_OpenSIPS here].

*TEMPORARY CONTENT*

{{{
sudo aptitude install build-essential bison lynx subversion flex libmysqld-dev mysql-server
wget http://opensips.org/pub/opensips/latest/src/opensips-1.7.1_src.tar.gz
tar zxvf opensips-1.7.1_src.tar.gz
cd opensips-1.7.1-tls
make all include_modules="db_mysql"
sudo make include_modules="db_mysql" prefix="/usr/local" install
sudo vim /usr/local/etc/opensips/opensipsctlrc
# Uncomment DBENGINE=MYSQL
sudo opensipsdbctl create
mysql -p -u root

grant all privileges on opensips.* to opensips@localhost identified by 'opensips';
use opensips;
insert into load_balancer (group_id, dst_uri, resources, description) values (1,'sip:143.54.12.121', 'pstn=32', 'FS1');
insert into load_balancer (group_id, dst_uri, resources, description) values (1,'sip:143.54.12.182', 'pstn=32', 'FS2');
quit;

sudo su
cp packaging/rpm/opensips.init /etc/init.d/opensips
sed -i "s/\/usr\/sbin\/opensips/\/usr\/local\/sbin\/opensips/g" /etc/init.d/opensips
sed -i "s/\/etc\/opensips/\/usr\/local\/etc\/opensips/g" /etc/init.d/opensips
sed -i "s/\/etc\/default\/opensips/\/usr\/local\/etc\/opensips/g" /etc/init.d/opensips
sed -i "s/RUN_OPENSIPS=no/RUN_OPENSIPS=yes/g" /etc/init.d/opensips
chmod +x /etc/init.d/opensips
exit

sudo useradd -d /usr/local/etc/opensips -s /sbin/nologin opensips
sudo cp /usr/local/etc/opensips/opensips.cfg /usr/local/etc/opensips/opensips.cfg.backup
# Copy the .cfg and replace the "listen" to the OpenSIPS address
}}}
= Links =

  * Extracting freeswitch, freeswitch "cloud" [[http://groups.google.com/group/bigbluebutton-setup/browse_thread/thread/69c108175d5cdc4a link]]
  * Install OpenSIPS on Debian or Ubuntu [[http://vidodz.wordpress.com/2009/07/28/install-opensips-on-debian-or-ubuntu/ link]]
  * OpenSIPS Installation Notes [[http://opensips.svn.sourceforge.net/viewvc/opensips/trunk/INSTALL link]]