<font color="red">This document is under development.</font> The content described here is being used internally by Mconf.

= Introduction =

In this document we will describe step-by-step how to scale !BigBlueButton in order to support a larger number of participants. Currently the default installation of !BigBlueButton is designed to support up to 25 simultaneous users [[http://code.google.com/p/bigbluebutton/wiki/FAQ#How_many_simultaneous_users_can_BigBlueButton_support link]], but this guide is intended to increase this number to hundreds (or even thousands) of users.

= Installing !BigBlueButton 0.8 beta 3 =

Follow the instructions detailed [http://code.google.com/p/bigbluebutton/wiki/08InstallationUbuntu here].

= Installing FreeSWITCH =

{{{
# Add the BigBlueButton key
wget http://ubuntu.bigbluebutton.org/bigbluebutton.asc -O- | sudo apt-key add -

# Add the BigBlueButton repository URL and ensure the multiverse is enabled
echo "deb http://ubuntu.bigbluebutton.org/lucid_dev_08/ bigbluebutton-lucid main" | sudo tee /etc/apt/sources.list.d/bigbluebutton.list
echo "deb http://us.archive.ubuntu.com/ubuntu/ lucid multiverse" | sudo tee -a /etc/apt/sources.list

sudo apt-get install bbb-freeswitch bbb-freeswitch-config
}}}

= Configuring the !BigBlueButton server =

{{{
# Set the FreeSWITCH server IP address
FS_HOST=

sudo sed -i "s:sip\.server\.host=.*:sip.server.host=$FS_HOST:g" /usr/share/red5/webapps/sip/WEB-INF/bigbluebutton-sip.properties
sudo sed -i "s:esl\.host=.*:esl\.host=$FS_HOST:g" /usr/share/red5/webapps/bigbluebutton/WEB-INF/bigbluebutton.properties

# Restart the BigBlueButton server
sudo bbb-conf --clean
}}}

= Configuring the FreeSWITCH server =

{{{
# Get the current IP address from ifconfig
HOST=`ifconfig  | grep 'inet addr:'| grep -v '127.0.0.1' | cut -d: -f2 | awk '{ print $1}'`

sudo sed -i "s:name=\"listen-ip\" value=\".*\":name=\"listen-ip\" value=\"$HOST\":g" /opt/freeswitch/conf/autoload_configs/event_socket.conf.xml

# Restart the FreeSWITCH server
sudo service bbb-freeswitch restart
}}}


Uncomment the following line on `/opt/freeswitch/conf/sip_profiles/external.xml`. <font color="red">Check if it's really necessary!</font>

{{{
<!--<param name="force-register-domain" value="$${domain}"/>-->
}}}

= Installing OpenSIPS =

Installing the opensips system on a 32bit Debian virtual machine.

{{{
apt-get update 
apt-get upgrade
apt-get install build-essential openssl bison flex
apt-get install mysql-server
#insert MySQL root password
apt-get install libmysqlclient16 libmysqlclient-dev

wget http://opensips.org/pub/opensips/1.7.1/packages/debian/6.0-squeeze/opensips_1.7.1-1_i386.deb
wget http://opensips.org/pub/opensips/1.7.1/packages/debian/6.0-squeeze/opensips-mysql-module_1.7.1-1_i386.deb

#installing opensips package
dpkg -i opensips_1.7.1-1_i386.deb
dpkg -i opensips-mysql-module_1.7.1-1_i386.deb
}}}

Configuring opensips.

{{{
vim /etc/default/opensips
# change RUN_OPENSIPS parameter to "yes":
RUN_OPENSIPS=yes
# adjust the remaining parameters according to your needs.

# init opensips files and folders
mkdir /var/run/opensips
touch /var/run/opensips/opensips.pid
chmod +x /etc/init.d/opensips

# define mysql parameters
vim /etc/opensips/opensipsctlrc
# new parameters:
SIP_DOMAIN=localhost
DBENGINE=MYSQL
DBHOST=localhost
DBNAME=opensips
DBRWUSER=opensips
DBRWPW="opensipsrw"
DBROUSER=opensipsro
DBROPW=opensipsro
DBROOTUSER="root"
PID_FILE=/var/run/opensips/opensips.pid

# create mysql tables
opensipsdbctl create

# configuring opensips parameters
vim /etc/opensips/opensips.cfg
# TODO: .cfg definition


# add a opensips user
useradd -d /usr/local/etc/opensips -s /sbin/nologin opensips

# create mysql user and password
mysql -p
mysql> grant all privileges on opensips.* to opensips@localhost identified by 'opensips';

# finally, running opensips service
service opensips restart
}}}

Opensips commands:
{{{
#command used to restart opensips
#opensipsctl restart
}}}

Reference links:

[http://opensips.svn.sourceforge.net/viewvc/opensips/trunk/INSTALL Opensips Manual]

[http://wiki.freeswitch.org/wiki/Enterprise_deployment_OpenSIPS Enterprise deployment OpenSIPS ]

[http://www.voip-info.org/wiki/view/Opensips+Installation,+How+to. Voip_info Opensips Installation]

[http://lists.opensips.org/pipermail/users/2010-September/014614.html Opensips Mailing List PID problem]

[http://www.opensips.org/Resources/DocsTsStart How to Read Opensips error output]

[http://www.opensips.org/Resources/Install Opensips Installation]

[http://opensips.org/pub/opensips/1.7.1/packages/debian/6.0-squeeze/ Opensips Debian Package repository]