= Mconf-Web UFRGS =

Documentação para instalação do portal web da UFRGS.

O código da aplicação está em `https://github.com/mconf-ufrgs/mconf-web`, que é uma versão customizada do original em `https://github.com/mconf/mconf-web`.

== Instalação ==

Seguir o guia padrão de instalação do Mconf-Web que está [MconfWebDeploymentManual nesta página], observando o seguinte:

  * Na [MconfWebDeploymentManual#3._Download_the_application seção 3], baixar a aplicação do endereço `git://github.com/mconf-ufrgs/mconf-web.git`.
  * Ainda na seção 3, no lugar de `git checkout v0.7`, utilizar o branch master: `git checkout master`.


== Instalação e configuração shibboleth ==

  # Habilitar SSL/HTTPS: [MconfWebSSL ver manual]
  # Habilitar o Shibboleth no servidor: [MconfWebShibboleth ver manual]
    * Algumas configurações do Shibboleth devem ser adaptadas pra federação da UFRGS. <font color=red>TODO: instruções do que deve ser adaptado</font>


== Configuração inicial ==

Após instalar a aplicação, acessar o endereço `/admin` da mesma (e.g. `http://mconf-teste.ufrgs.br/admin`) e logar com o usuário admin padrão:

  * Username: "admin"
  * Senha: "admin"

Após entrar com a conta "admin", a senha deste usuário pode ser modificada acessando a página "account".

Acessar a página de configuração da aplicação (mais detalhes [MconfWebConfiguring aqui]) para configurar os campos abaixo. Alguns desses campos requerem que a aplicação seja reiniciada para serem aplicados. Para reiniciar a aplicação veja [MconfWebDeploymentManual#Restart esta página].

(Nas configurações abaixo, *não* utilizar as aspas, usar apenas o conteúdo dentro delas.)

Configurações básicas:

  * Application Domain: colocar o domínio atribuído ao site.
  * Language: "`pt-br`"

Para a autenticação Shibboleth:

  * Enable Shibboleth: habilitar
  * Shibboleth environment variables (nota: separar itens com uma nova linha):
    {{{
cn
mail
ufrgsVinculo
uid
shib-.*
    }}}
  * Shibboleth field for email: "`mail`"
  * Shibboleth field for name: "`cn`"
  * Shibboleth field for login: "`uid`"

Com essas configurações o acesso através da federação já deve estar funcionando.

Configurações do SMTP para utilizar uma *conta do Gmail* (normalmente a maneira mais fácil de testar o envio de emails inicialmente):

  * SMTP login: "`ufrgs@mconf.org`"
  * SMTP password: <font color=blue><consultar equipe></font>
  * SMTP server: "`smtp.gmail.com`"
  * SMTP domain: "`gmail.com`"
  * SMTP port: "`587`"
  * Use TLS in SMTP: `<marcar>`
  * Auto start TLS in SMTP: `<marcar>`
  * SMTP authentication type: "plain"
  * SMTP sender: "ufrgs@mconf.org" (ou outro)

Configurações do SMTP para utilizar um *servidor de emails no localhost*:

  * SMTP login: <deixar em branco>
  * SMTP password: <deixar em branco>
  * SMTP server: "`localhost`"
  * SMTP domain: "`localhost`"
  * SMTP port: "`25`"
  * Use TLS in SMTP: <não marcar>
  * Auto start TLS in SMTP: <não marcar>
  * SMTP authentication type: <deixar em branco>
  * SMTP sender: "ufrgs@mconf.org" (ou outro)

Na aba "!BigBlueButton", haverá um servidor de web conferência já pré-cadastrado. Modifcar as configurações deste servidor para:

  * Name: "`Default Server`"
  * URL: "`http://lb.mconf.org/bigbluebutton/api`"
  * Security Salt: <font color=blue><consultar equipe></font>
  * Version: "`0.8`"
  * String ID: "`default-server`"

== Atualização de versão ==

Atualizar a versão do software (baixar nova versão do branch "ufrgs"):

{{{
cd ~/mconf-web/current
git checkout ufrgs
git pull origin ufrgs
}}}

Atualizar as dependências:

{{{
git submodule update
bundle install --without=development test
}}}

Migrar o banco de dados:

{{{
bundle exec rake db:migrate RAILS_ENV=production
}}}

Atualizar a crontab:

{{{
bundle exec whenever --update-crontab mconf-web --set environment=production --roles db
}}}

Mais detalhes sobre as versões do Mconf-Web em [MconfWebRoadMap changelog e road map].